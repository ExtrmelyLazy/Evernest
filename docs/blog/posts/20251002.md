# 如何使用 Vitepress 搭建网站

## 引言

### 框架
拥有一个个人网站是一件很酷的事情(哪怕你只是写了一小段话)，拥有一个网站就相当于在这庞大的互联网上拥有了一个小窝，那么，如何搭建一个网站呢？自己写较为繁琐，所以我推荐使用框架。现在拿来做博客的框架很多，比如 *Hexo* ，这里我使用 *Vitepress*

### 介绍
::: info
详见 [Vitepress官方文档](https://vitepress.dev/)
:::
*Vitepress* 是基于 *Vue.js* 的一个框架，常被用来构建博客，你可以用 *Markdown* 书写文章，然后它会帮你生成静态页面。本站使用的就是 *Vitepress*

## 准备

#### 工具
- *Github*
- *Termux*

#### 手机
首先你要下载 [Termux](www.termux.dev)  
推荐使用 *F-droid* 源，不推荐 *Play Store* ，因为版本太旧了  
刚刚下载好的 *Termux* 需要初始化，通常不会很长时间。初始化完毕之后输入  
``` bash
pkg update
pkg upgrade
```
然后我们换一下源，提高一下下载速度  
``` bash
termux-change-repo
```
这里会出现一个图形化界面，按空格选第一个，然后用箭头选 *Mirrors in Chinese* ，他会自己使用国内速度快的源  
然后我们去 *Github* 注册一个账号，用自己邮箱就行，比较简单。创建一个仓库(*repository*)，名字随便，可以选 *public(公开)* ，也可以不选,然后不要选 *Add a README*。  
好，现在我们可以着手构建了。  
在 *Termux* 中，输入  
```bash
mkdir my-vitepress # 创建项目文件夹
cd my-vitepress # 进入文件夹
```
创立好项目文件夹后，我们初始化  
```bash
npm init -y
```
然后我们手动创建一下文件，这里不用官方教程的`npx Vitepress init`，感兴趣的可以自己试试。  
```bash
# 确保在项目目录中
cd ~/my-vitepress

# 创建文档目录
mkdir docs

# 创建基本配置文件
nano docs/index.md
```
注意到，最后一行使用了 `nano` ，这是一个编辑器，通常情况，运行上述命令后你会进入 *Termux* 的编辑页面。我们输入  
```markdown
# Hello VitePress

欢迎来到我的 VitePress 网站！

- [关于我](./about.md)
```
然后大家记住一个操作：在 *nano* 编辑器中，按 `Ctrl + X` 保存，然后按 `y` ，然后按回车退出。本教程称为 *nano退出法*  
使用 *nano退出法* 保存退出。  
然后我们创建并修改配置文件 `config.mjs`  
```bash
# 在项目根目录下创建 .vitepress 配置目录
mkdir docs/.vitepress

# 创建配置文件
nano docs/.vitepress/config.mjs
```
输入  
```javascript
export default {
  title: 'My VitePress Site', # 网站名称
  description: 'A VitePress site running on Termux', # 简介
  themeConfig: {
    nav: [
      { text: 'Home', link: '/' }, # 导航
      { text: 'About', link: '/about' }
    ],
    sidebar: [
      {
        text: 'Guide', # 侧边栏
        items: [
          { text: 'Introduction', link: '/introduction' }
        ]
      }
    ]
  }
}
```
然后 *nano退出法*  
接着创建更多页面  
```bash
# 创建关于页面
nano docs/about.md
```
输入  
```bash
# About Page

This is the about page of my VitePress site.

[Back to Home](/)
```
然后修改 `package.json`  
```bash
# 编辑 package.json
nano package.json
```
将 `script` 部分修改为  
```bash
{
  "scripts": {
    "dev": "vitepress dev docs",
    "build": "vitepress build docs",
    "preview": "vitepress preview docs"
  }
}
```
然后我们准备推送到 *Github* ，首先创建一个 `gitignore` 告诉它哪些不用上传  
```bash
# 先创建 .gitignore
nano .gitignore
```
然后输入  
```bash
node_modules/
docs/.vitepress/dist/
docs/.vitepress/cache/
.cache
.temp
*.log
.DS_Store
```
我们来初始化 *Git仓库*  
```bash
# 初始化 Git
git init

# 添加文件到暂存区
git add .

# 查看将要提交的文件（确认没有 node_modules）
git status

# 提交
git commit -m "Initial commit: VitePress project setup"
```
然后推送到 *Github*  
```bash
# 连接远程仓库
git remote add origin https://github.com/你的Github名/你的仓库名.git #替换

# 创建并切换到 main 分支
git branch -M main

# 推送到 GitHub
git push -u origin main
```
好，它会让你输入 *Password* ，我们打开 *Github* ，点击你的头像，点击 *Settings* ，然后下滑找到 *Developer settings* ，选择 *Personal Access Token* ，然后在展开的菜单里选择 *Tonkens(classic)* ，点击 *Generate new token(classic)* ，通过一下登录验证，在 *Note* 中填写你的用途，把 *Expiration* 设置的长一点，比如 *90 days* 或者 *no expiration* 然后把下面的勾一下 *repo* 和 *workflow* ，点击 *Generate tokens*   
**然后截图并复制它生成的一长串字符，保存下来放到安全地方，只显示一次**  
好，粘贴你的 *Token* 到 *Password* ，它为了保密是不会显示密码的，很正常。  
不出意外的话，它会自己提交到 *Github*。    
接下来我们来写工作流。 
在 *Github* 中，新建一个文件，文件名 `deploy.yml` ，路径是 `.github/workflows/   
文件内容：
```bash
name: Deploy to Netlify

on:
  push:
    branches: [main]
  pull_request:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: npm

      - name: Install dependencies
        run: npm ci

      - name: Build with VitePress
        run: npm run build

      - name: Deploy to Netlify
        uses: netlify/actions/cli@master
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
        with:
          args: deploy --prod --dir=docs/.vitepress/dist
```
这里我们注意到，我们用了 `secrets` ，而名字是 `NETLIFY_AUTH_TOKEN` 这是因为我使用 *Netlify* 去部署的静态站点，这里等会在讲，你可以使用其他的工作流。  
好，如果你打算使用我的方案，那么点击右上角三点菜单，向下划有一个 *Secrets and variables* ，点击会展开一个浮动菜单，选择 *Action*  
然后我们点击 *New repository secret* ，这里 *Name* 填写 `NETLIFY_AUTH_TOKEN` ，下方的 *Secret* 填写你的 *Token*    
我们随便提交一个更改，比如改一下 `index.md` ，然后点三点菜单，看 *Action* ，如果运行显示绿色，那么就成功了。   

#### 电脑
其实我没有电脑(hhh)，但大概都是一样的。本来 *Termux* 也是模拟的 *Linux* ，电脑直接用 *Linux* 就行，无非就是包管理器不一样，其他都是一样的

## 部署
我选择 *Netlify* 部署网站，你可以用 *Clouflare* 或者是自己的服务器。  
打开 [Netlify](www.netlify.com) ，注册完账号后点击 *Import new project* ，选择 *Github* ，登录，选择你的仓库，然后它会跳转回来   
之后它会到一个菜单，填写部署设置。这里 *Project name* 填一个名字，然后生成的域名就会是 `你写的名字.netlify.app` ，然后 *build command* 写 *npm run build* ，*Publish directory* 写 *docs/.vitepress/dist* ，最后点击 *Deploy project* 就好啦！

## 结语
我花了一下午做出了这个教程，希望对你有帮助！  
**二编** 不对啊不对，那个 *Netlify* 的部署那里是需要新建一个 *Team* 的，注意一下
**三编** 怎么我图片不管用，加载不出来啊
